<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Cura Profile Maker</title>
        <link rel="stylesheet" href="css/styles.css?v=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    </head>
    <body>
        <h1 style="text-align: center;">Cura Profile Maker</h1>
        <div class="alert alert-warning alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <strong>Warning!</strong> Check <a href="https://github.com/Ultimaker/Cura/tree/master/resources/settings">here</a> to make sure the profile you want hasn't already been created.
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Machine Info</h3>
            </div>
            <div class="panel-body">
                <div class="input-group">
                    <span class="input-group-addon">Machine ID</span>
                    <input type="text" id="machine_id" class="form-control" placeholder="unique ID">
                </div>
                <div class="input-group">
                    <span class="input-group-addon">Machine Name</span>
                    <input type="text" id="machine_name" class="form-control">
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Machine Properties</h3>
            </div>
            <div class="panel-body">
                <div class="input-group">
                    <span class="input-group-addon">Machine Printable Area</span>
                    <input type="number" id="machine_width" class="form-control" value="200">
                    <span class="input-group-addon">X</span>
                    <input type="number" id="machine_depth" class="form-control" value="200">
                    <span class="input-group-addon">Y</span>
                    <input type="number" id="machine_height" class="form-control" value="200">
                    <span class="input-group-addon">Z</span>
                </div>
                <div class="input-group">
                    <span class="input-group-addon">
                    <input type="checkbox" id="machine_center_is_zero">
                    </span>
                    <span class="form-control">Machine Center is Zero</span>
                </div>
                <div class="input-group">
                    <span class="input-group-addon">Nozzle Orifice</span>
                    <input type="number" id="machine_nozzle_orifice" class="form-control" value="0.4">
                </div>
                <div class="input-group">
                    <span class="input-group-addon">
                    <input type="checkbox" id="heated_bed" checked>
                    </span>
                    <span class="form-control">Heated bed?</span>
                </div>
            </div>
        </div>
        <button class="btn btn-primary" id="generate_btn">Generate</button>
        </br>
        <pre class="well" id="profile_preview"></pre>
        <div class="alert alert-info" role="alert">Paste the above into a .json file and place it in resources/settings</div>

        <script>
			var profile = {
			  "id": "ultimaker_original",
			  "name": "Ultimaker Original",
			  "icon": "icon_ultimaker.png",
			  "platform": "",
			
			  "inherits": "fdmprinter.json",
			
			  "machine_settings": {
			    "machine_width": {
			      "default": 200
			    },
			    "machine_height": {
			      "default": 200
			    },
			    "machine_depth": {
			      "default": 200
			    },
			    "machine_center_is_zero": {
			      "default": false
			    },
			    "machine_nozzle_size": {
			      "default": 0.4
			    },
			    "machine_head_shape_min_x": {
			      "default": 75
			    },
			    "machine_head_shape_min_y": {
			      "default": 18
			    },
			    "machine_head_shape_max_x": {
			      "default": 18
			    },
			    "machine_head_shape_max_y": {
			      "default": 35
			    },
			    "machine_nozzle_gantry_distance": {
			      "default": 55
			    },
			    "machine_nozzle_offset_x_1": {
			      "default": 18.0
			    },
			    "machine_nozzle_offset_y_1": {
			      "default": 0.0
			    },
			    "machine_gcode_flavor": {
			      "default": "RepRap (Marlin/Sprinter)"
			    },
			
			    "machine_start_gcode": {
			      "default": "G21 ;metric values\nG90 ;absolute positioning\nM82 ;set extruder to absolute mode\nM107 ;start with the fan off\nG28 X0 Y0 ;move X/Y to min endstops\nG28 Z0 ;move Z to min endstops\nG1 Z15.0 F9000 ;move the platform down 15mm\nG92 E0 ;zero the extruded length\nG1 F200 E3 ;extrude 3mm of feed stock\nG92 E0 ;zero the extruded length again\nG1 F9000\n;Put printing message on LCD screen\nM117 Printing..."
			    },
			    "machine_end_gcode": {
			      "default": "M104 S0 ;extruder heater off\nM140 S0 ;heated bed heater off (if you have it)\nG91 ;relative positioning\nG1 E-1 F300  ;retract the filament a bit before lifting the nozzle, to release some of the pressure\nG1 Z+0.5 E-5 X-20 Y-20 F9000 ;move Z up a bit and retract filament even more\nG28 X0 Y0 ;move X/Y to min endstops, so the head is out of the way\nM84 ;steppers off\nG90 ;absolute positioning"
			    }
			  },
			
			  "categories": {
			    "material": {
			      "settings": {
			        "material_bed_temperature": {
			          "visible": true
			        }
			      }
			    }
			  }
			};
			
			$("#machine_id").on("input", function() {
				profile.id = $("#machine_id").val();
			});
			
			$("#machine_name").on("input", function() {
				profile.name = $("#machine_name").val();
			});
			
			$("#machine_width").on("input", function() {
				profile.machine_settings.machine_width.default = parseInt($("#machine_width").val());
			});
			
			$("#machine_depth").on("input", function() {
				profile.machine_settings.machine_depth.default = parseInt($("#machine_depth").val());
			});
			
			$("#machine_height").on("input", function() {
				profile.machine_settings.machine_height.default = parseInt($("#machine_height").val());
			});
			
			$("#machine_nozzle_orifice").on("input", function() {
				profile.machine_settings.machine_nozzle_size.
				default = parseFloat($("#machine_nozzle_orifice").val());
			});
			
			$("#heated_bed").on("change", function() {
				profile.categories.material.settings.material_bed_temperature.visible = $("#heated_bed").prop("checked");
			});
			
			$("#machine_center_is_zero").on("change", function() {
				profile.machine_settings.machine_center_is_zero.
				default = $("#machine_center_is_zero").prop("checked");
			});
			
			function updateProfileView() {
				$("#profile_preview").text(JSON.stringify(profile));
			}
			
			$("#generate_btn").click(function() {
				updateProfileView();
			});
        </script>
    </body>
</html>
